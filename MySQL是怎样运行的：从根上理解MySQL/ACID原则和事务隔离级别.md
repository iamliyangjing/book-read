一条SQL语句从诞生直到结束的多姿多彩的历程

## 一条SQL执行前会经历的过程

连接池这块重新理解了，连接池分为两块去理解，第一部分就是客户端这边主要是网络连接，MySQL服务器那边就是工作线程池。客户端主要是为了减少TCP三次握手的过程，而建立了数据库连接池。<font color='red'>**其实也可以这样理解，`MySQL`连接池维护的是工作线程，客户端连接池则维护的是网络连接。**</font>





## 一条SQL在数据库中会经历的过程

一个sql完整的执行过程，主要还是靠Server层的一些组件，SQL接口-解析器-预处理器-优化器-执行器-存储引擎接口

![image-20230302214021507](C:\Users\86183\AppData\Roaming\Typora\typora-user-images\image-20230302214021507.png)



## 一条SQL执行完成后是如何返回的？

 **一条【读 SQL】 或 【写 SQL】执行完成后，由于SQL 操作的属性不同，两者之间也会存在差异性。**

**读sql**

 前面聊到过，`MySQL`执行一条查询`SQL`时，数据是逐条返回的模式，因为如果等待所有数据全部查出来之后再一次性返回，必然会导致撑满内存。<font color='red'>**首先把完整的数据库返回给Server层然后再次处理返回给客户端**</font>



**写sql**

 写`SQL`执行的过程会比读`SQL`复杂，但写`SQL`的结果返回却很简单，写类型的操作执行完成之后，仅会返回执行状态、受影响的行数以及执行耗时。**写成功了返回大于0，不成功则返回0。**



**执行结果如何返回给客户端？**

通过数据库连接，在MySQL客户端 show processlist 可以查看 客户端地址，然后通过TCP 连接返回

![image-20230302220315976](C:\Users\86183\AppData\Roaming\Typora\typora-user-images\image-20230302220315976.png)